{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _createReactClass = require('create-react-class');\n\nvar _createReactClass2 = _interopRequireDefault(_createReactClass);\n\nvar _momentRange = require('./moment-range');\n\nvar _momentRange2 = _interopRequireDefault(_momentRange);\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _calendar = require('calendar');\n\nvar _calendar2 = _interopRequireDefault(_calendar);\n\nvar _BemMixin = require('./utils/BemMixin');\n\nvar _BemMixin2 = _interopRequireDefault(_BemMixin);\n\nvar _CustomPropTypes = require('./utils/CustomPropTypes');\n\nvar _CustomPropTypes2 = _interopRequireDefault(_CustomPropTypes);\n\nvar _Legend = require('./Legend');\n\nvar _Legend2 = _interopRequireDefault(_Legend);\n\nvar _CalendarMonth = require('./calendar/CalendarMonth');\n\nvar _CalendarMonth2 = _interopRequireDefault(_CalendarMonth);\n\nvar _CalendarDate = require('./calendar/CalendarDate');\n\nvar _CalendarDate2 = _interopRequireDefault(_CalendarDate);\n\nvar _PaginationArrow = require('./PaginationArrow');\n\nvar _PaginationArrow2 = _interopRequireDefault(_PaginationArrow);\n\nvar _isMomentRange = require('./utils/isMomentRange');\n\nvar _isMomentRange2 = _interopRequireDefault(_isMomentRange);\n\nvar _hasUpdatedValue = require('./utils/hasUpdatedValue');\n\nvar _hasUpdatedValue2 = _interopRequireDefault(_hasUpdatedValue);\n\nvar _getYearMonth = require('./utils/getYearMonth');\n\nvar _reactAddonsPureRenderMixin = require('react-addons-pure-render-mixin');\n\nvar _reactAddonsPureRenderMixin2 = _interopRequireDefault(_reactAddonsPureRenderMixin);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar absoluteMinimum = (0, _momentRange2.default)(new Date(-8640000000000000 / 2)).startOf('day');\nvar absoluteMaximum = (0, _momentRange2.default)(new Date(8640000000000000 / 2)).startOf('day');\n\nfunction noop() {}\n\nvar DateRangePicker = (0, _createReactClass2.default)({\n  mixins: [_BemMixin2.default, _reactAddonsPureRenderMixin2.default],\n  displayName: \"DateRangePicker\",\n  propTypes: {\n    bemBlock: _propTypes2.default.string,\n    bemNamespace: _propTypes2.default.string,\n    className: _propTypes2.default.string,\n    dateStates: _propTypes2.default.array,\n    // an array of date ranges and their states\n    defaultState: _propTypes2.default.string,\n    disableNavigation: _propTypes2.default.bool,\n    firstOfWeek: _propTypes2.default.oneOf([0, 1, 2, 3, 4, 5, 6]),\n    helpMessage: _propTypes2.default.string,\n    initialDate: _propTypes2.default.instanceOf(Date),\n    initialFromValue: _propTypes2.default.bool,\n    initialMonth: _propTypes2.default.number,\n    // Overrides values derived from initialDate/initialRange\n    initialRange: _propTypes2.default.object,\n    initialYear: _propTypes2.default.number,\n    // Overrides values derived from initialDate/initialRange\n    locale: _propTypes2.default.string,\n    maximumDate: _propTypes2.default.instanceOf(Date),\n    minimumDate: _propTypes2.default.instanceOf(Date),\n    numberOfCalendars: _propTypes2.default.number,\n    onHighlightDate: _propTypes2.default.func,\n    // triggered when a date is highlighted (hovered)\n    onHighlightRange: _propTypes2.default.func,\n    // triggered when a range is highlighted (hovered)\n    onSelect: _propTypes2.default.func,\n    // triggered when a date or range is selectec\n    onSelectStart: _propTypes2.default.func,\n    // triggered when the first date in a range is selected\n    paginationArrowComponent: _propTypes2.default.func,\n    selectedLabel: _propTypes2.default.string,\n    selectionType: _propTypes2.default.oneOf(['single', 'range']),\n    singleDateRange: _propTypes2.default.bool,\n    showLegend: _propTypes2.default.bool,\n    stateDefinitions: _propTypes2.default.object,\n    value: _CustomPropTypes2.default.momentOrMomentRange\n  },\n  getDefaultProps: function getDefaultProps() {\n    var date = new Date();\n    var initialDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n    return {\n      bemNamespace: null,\n      bemBlock: 'DateRangePicker',\n      className: '',\n      numberOfCalendars: 1,\n      firstOfWeek: 0,\n      disableNavigation: false,\n      nextLabel: '',\n      previousLabel: '',\n      initialDate: initialDate,\n      initialFromValue: true,\n      locale: (0, _momentRange2.default)().locale(),\n      selectionType: 'range',\n      singleDateRange: false,\n      stateDefinitions: {\n        '__default': {\n          color: null,\n          selectable: true,\n          label: null\n        }\n      },\n      selectedLabel: \"Your selected dates\",\n      defaultState: '__default',\n      dateStates: [],\n      showLegend: false,\n      onSelect: noop,\n      paginationArrowComponent: _PaginationArrow2.default\n    };\n  },\n  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n    var nextDateStates = this.getDateStates(nextProps);\n    var nextEnabledRange = this.getEnabledRange(nextProps);\n    var updatedState = {\n      selectedStartDate: null,\n      hideSelection: false,\n      dateStates: this.state.dateStates && _immutable2.default.is(this.state.dateStates, nextDateStates) ? this.state.dateStates : nextDateStates,\n      enabledRange: this.state.enabledRange && this.state.enabledRange.isSame(nextEnabledRange) ? this.state.enabledRange : nextEnabledRange\n    };\n\n    if ((0, _hasUpdatedValue2.default)(this.props, nextProps)) {\n      if (!nextProps.value || !this.isStartOrEndVisible(nextProps)) {\n        var yearMonth = (0, _getYearMonth.getYearMonthProps)(nextProps);\n        updatedState.year = yearMonth.year;\n        updatedState.month = yearMonth.month;\n      }\n    }\n\n    this.setState(updatedState);\n  },\n  getInitialState: function getInitialState() {\n    var now = new Date();\n    var _props = this.props,\n        initialYear = _props.initialYear,\n        initialMonth = _props.initialMonth,\n        initialFromValue = _props.initialFromValue,\n        value = _props.value;\n    var year = now.getFullYear();\n    var month = now.getMonth();\n\n    if (Number.isInteger(initialYear) && Number.isInteger(initialMonth)) {\n      year = initialYear;\n      month = initialMonth;\n    }\n\n    if (initialFromValue && (_momentRange2.default.isMoment(value) || (0, _isMomentRange2.default)(value))) {\n      var yearMonth = (0, _getYearMonth.getYearMonthProps)(this.props);\n      month = yearMonth.month;\n      year = yearMonth.year;\n    }\n\n    return {\n      year: year,\n      month: month,\n      selectedStartDate: null,\n      highlightedDate: null,\n      highlightRange: null,\n      hideSelection: false,\n      enabledRange: this.getEnabledRange(this.props),\n      dateStates: this.getDateStates(this.props)\n    };\n  },\n  getEnabledRange: function getEnabledRange(props) {\n    var min = props.minimumDate ? (0, _momentRange2.default)(props.minimumDate).startOf('day') : absoluteMinimum;\n    var max = props.maximumDate ? (0, _momentRange2.default)(props.maximumDate).startOf('day') : absoluteMaximum;\n    return _momentRange2.default.range(min, max);\n  },\n  getDateStates: function getDateStates(props) {\n    var dateStates = props.dateStates,\n        defaultState = props.defaultState,\n        stateDefinitions = props.stateDefinitions;\n    var actualStates = [];\n    var minDate = absoluteMinimum;\n    var maxDate = absoluteMaximum;\n    var dateCursor = (0, _momentRange2.default)(minDate).startOf('day');\n\n    var defs = _immutable2.default.fromJS(stateDefinitions);\n\n    dateStates.forEach(function (s) {\n      var r = s.range;\n      var start = r.start.startOf('day');\n      var end = r.end.startOf('day');\n\n      if (!dateCursor.isSame(start, 'day')) {\n        actualStates.push({\n          state: defaultState,\n          range: _momentRange2.default.range(dateCursor, start)\n        });\n      }\n\n      actualStates.push(s);\n      dateCursor = end;\n    });\n    actualStates.push({\n      state: defaultState,\n      range: _momentRange2.default.range(dateCursor, maxDate)\n    }); // sanitize date states\n\n    return _immutable2.default.List(actualStates).map(function (s) {\n      var def = defs.get(s.state);\n      return _immutable2.default.Map({\n        range: s.range,\n        state: s.state,\n        selectable: def.get('selectable', true),\n        color: def.get('color')\n      });\n    });\n  },\n  isDateDisabled: function isDateDisabled(date) {\n    return !this.state.enabledRange.contains(date);\n  },\n  isDateSelectable: function isDateSelectable(date) {\n    return this.dateRangesForDate(date).some(function (r) {\n      return r.get('selectable');\n    });\n  },\n  nonSelectableStateRanges: function nonSelectableStateRanges() {\n    return this.state.dateStates.filter(function (d) {\n      return !d.get('selectable');\n    });\n  },\n  dateRangesForDate: function dateRangesForDate(date) {\n    return this.state.dateStates.filter(function (d) {\n      return d.get('range').contains(date);\n    });\n  },\n  sanitizeRange: function sanitizeRange(range, forwards) {\n    /* Truncates the provided range at the first intersection\n     * with a non-selectable state. Using forwards to determine\n     * which direction to work\n     */\n    var blockedRanges = this.nonSelectableStateRanges().map(function (r) {\n      return r.get('range');\n    });\n    var intersect = void 0;\n\n    if (forwards) {\n      intersect = blockedRanges.find(function (r) {\n        return range.intersect(r);\n      });\n\n      if (intersect) {\n        return _momentRange2.default.range(range.start, intersect.start);\n      }\n    } else {\n      intersect = blockedRanges.findLast(function (r) {\n        return range.intersect(r);\n      });\n\n      if (intersect) {\n        return _momentRange2.default.range(intersect.end, range.end);\n      }\n    }\n\n    if (range.start.isBefore(this.state.enabledRange.start)) {\n      return _momentRange2.default.range(this.state.enabledRange.start, range.end);\n    }\n\n    if (range.end.isAfter(this.state.enabledRange.end)) {\n      return _momentRange2.default.range(range.start, this.state.enabledRange.end);\n    }\n\n    return range;\n  },\n  highlightRange: function highlightRange(range) {\n    this.setState({\n      highlightedRange: range,\n      highlightedDate: null\n    });\n\n    if (typeof this.props.onHighlightRange === 'function') {\n      this.props.onHighlightRange(range, this.statesForRange(range));\n    }\n  },\n  onUnHighlightDate: function onUnHighlightDate() {\n    this.setState({\n      highlightedDate: null\n    });\n  },\n  onSelectDate: function onSelectDate(date) {\n    var selectionType = this.props.selectionType;\n    var selectedStartDate = this.state.selectedStartDate;\n\n    if (selectionType === 'range') {\n      if (selectedStartDate) {\n        this.completeRangeSelection();\n      } else if (date && !this.isDateDisabled(date) && this.isDateSelectable(date)) {\n        this.startRangeSelection(date);\n\n        if (this.props.singleDateRange) {\n          this.highlightRange(_momentRange2.default.range(date, date));\n        }\n      }\n    } else {\n      if (!this.isDateDisabled(date) && this.isDateSelectable(date)) {\n        this.completeSelection();\n      }\n    }\n  },\n  onHighlightDate: function onHighlightDate(date) {\n    var selectionType = this.props.selectionType;\n    var selectedStartDate = this.state.selectedStartDate;\n    var datePair = void 0;\n    var range = void 0;\n    var forwards = void 0;\n\n    if (selectionType === 'range') {\n      if (selectedStartDate) {\n        datePair = _immutable2.default.List.of(selectedStartDate, date).sortBy(function (d) {\n          return d.unix();\n        });\n        range = _momentRange2.default.range(datePair.get(0), datePair.get(1));\n        forwards = range.start.unix() === selectedStartDate.unix();\n        range = this.sanitizeRange(range, forwards);\n        this.highlightRange(range);\n      } else if (!this.isDateDisabled(date) && this.isDateSelectable(date)) {\n        this.highlightDate(date);\n      }\n    } else {\n      if (!this.isDateDisabled(date) && this.isDateSelectable(date)) {\n        this.highlightDate(date);\n      }\n    }\n  },\n  startRangeSelection: function startRangeSelection(date) {\n    this.setState({\n      hideSelection: true,\n      selectedStartDate: date\n    });\n\n    if (typeof this.props.onSelectStart === 'function') {\n      this.props.onSelectStart((0, _momentRange2.default)(date));\n    }\n  },\n  statesForDate: function statesForDate(date) {\n    return this.state.dateStates.filter(function (d) {\n      return date.within(d.get('range'));\n    }).map(function (d) {\n      return d.get('state');\n    });\n  },\n  statesForRange: function statesForRange(range) {\n    if (range.start.isSame(range.end, 'day')) {\n      return this.statesForDate(range.start);\n    }\n\n    return this.state.dateStates.filter(function (d) {\n      return d.get('range').intersect(range);\n    }).map(function (d) {\n      return d.get('state');\n    });\n  },\n  completeSelection: function completeSelection() {\n    var highlightedDate = this.state.highlightedDate;\n\n    if (highlightedDate) {\n      this.setState({\n        hideSelection: false,\n        highlightedDate: null\n      });\n      this.props.onSelect(highlightedDate, this.statesForDate(highlightedDate));\n    }\n  },\n  completeRangeSelection: function completeRangeSelection() {\n    var range = this.state.highlightedRange;\n\n    if (range && (!range.start.isSame(range.end, 'day') || this.props.singleDateRange)) {\n      this.setState({\n        selectedStartDate: null,\n        highlightedRange: null,\n        highlightedDate: null,\n        hideSelection: false\n      });\n      this.props.onSelect(range, this.statesForRange(range));\n    }\n  },\n  highlightDate: function highlightDate(date) {\n    this.setState({\n      highlightedDate: date\n    });\n\n    if (typeof this.props.onHighlightDate === 'function') {\n      this.props.onHighlightDate(date, this.statesForDate(date));\n    }\n  },\n  getMonthDate: function getMonthDate() {\n    return (0, _momentRange2.default)(new Date(this.state.year, this.state.month, 1));\n  },\n  isStartOrEndVisible: function isStartOrEndVisible(props) {\n    var _this = this;\n\n    var value = props.value,\n        selectionType = props.selectionType,\n        numberOfCalendars = props.numberOfCalendars;\n\n    var isVisible = function isVisible(date) {\n      var yearMonth = (0, _getYearMonth.getYearMonth)(date);\n      var isSameYear = yearMonth.year === _this.state.year;\n      var isMonthVisible = yearMonth.month === _this.state.month || numberOfCalendars === 2 && yearMonth.month - 1 === _this.state.month;\n      return isSameYear && isMonthVisible;\n    };\n\n    if (selectionType === 'single') {\n      return isVisible(value);\n    }\n\n    return isVisible(value.start) || isVisible(value.end);\n  },\n  canMoveBack: function canMoveBack() {\n    if (this.getMonthDate().subtract(1, 'days').isBefore(this.state.enabledRange.start)) {\n      return false;\n    }\n\n    return true;\n  },\n  moveBack: function moveBack() {\n    var monthDate = void 0;\n\n    if (this.canMoveBack()) {\n      monthDate = this.getMonthDate();\n      monthDate.subtract(1, 'months');\n      this.setState((0, _getYearMonth.getYearMonth)(monthDate));\n    }\n  },\n  canMoveForward: function canMoveForward() {\n    if (this.getMonthDate().add(this.props.numberOfCalendars, 'months').isAfter(this.state.enabledRange.end)) {\n      return false;\n    }\n\n    return true;\n  },\n  moveForward: function moveForward() {\n    var monthDate = void 0;\n\n    if (this.canMoveForward()) {\n      monthDate = this.getMonthDate();\n      monthDate.add(1, 'months');\n      this.setState((0, _getYearMonth.getYearMonth)(monthDate));\n    }\n  },\n  changeYear: function changeYear(year) {\n    var _state = this.state,\n        enabledRange = _state.enabledRange,\n        month = _state.month;\n\n    if ((0, _momentRange2.default)({\n      years: year,\n      months: month,\n      date: 1\n    }).unix() < enabledRange.start.unix()) {\n      month = enabledRange.start.month();\n    }\n\n    if ((0, _momentRange2.default)({\n      years: year,\n      months: month + 1,\n      date: 1\n    }).unix() > enabledRange.end.unix()) {\n      month = enabledRange.end.month();\n    }\n\n    this.setState({\n      year: year,\n      month: month\n    });\n  },\n  changeMonth: function changeMonth(date) {\n    this.setState({\n      month: date\n    });\n  },\n  rangesOverlap: function rangesOverlap(rangeA, rangeB) {\n    if (rangeA.overlaps(rangeB) || rangeA.contains(rangeB.start) || rangeA.contains(rangeB.end)) {\n      return true;\n    }\n\n    return false;\n  },\n  renderCalendar: function renderCalendar(index) {\n    var _props2 = this.props,\n        bemBlock = _props2.bemBlock,\n        bemNamespace = _props2.bemNamespace,\n        firstOfWeek = _props2.firstOfWeek,\n        numberOfCalendars = _props2.numberOfCalendars,\n        selectionType = _props2.selectionType,\n        value = _props2.value;\n    var _state2 = this.state,\n        dateStates = _state2.dateStates,\n        enabledRange = _state2.enabledRange,\n        hideSelection = _state2.hideSelection,\n        highlightedDate = _state2.highlightedDate,\n        highlightedRange = _state2.highlightedRange;\n    var monthDate = this.getMonthDate();\n    var year = monthDate.year();\n    var month = monthDate.month();\n    var key = index + '-' + year + '-' + month;\n    var props = void 0;\n    monthDate.add(index, 'months');\n    var cal = new _calendar2.default.Calendar(firstOfWeek);\n\n    var monthDates = _immutable2.default.fromJS(cal.monthDates(monthDate.year(), monthDate.month()));\n\n    var monthStart = monthDates.first().first();\n    var monthEnd = monthDates.last().last();\n\n    var monthRange = _momentRange2.default.range(monthStart, monthEnd);\n\n    if (_momentRange2.default.isMoment(value) && !monthRange.contains(value)) {\n      value = null;\n    } else if ((0, _isMomentRange2.default)(value) && !this.rangesOverlap(monthRange, value)) {\n      value = null;\n    }\n\n    if (!_momentRange2.default.isMoment(highlightedDate) || !monthRange.contains(highlightedDate)) {\n      highlightedDate = null;\n    }\n\n    if (!(0, _isMomentRange2.default)(highlightedRange) || !this.rangesOverlap(monthRange, highlightedRange)) {\n      highlightedRange = null;\n    }\n\n    props = {\n      bemBlock: bemBlock,\n      bemNamespace: bemNamespace,\n      dateStates: dateStates,\n      enabledRange: enabledRange,\n      firstOfWeek: firstOfWeek,\n      hideSelection: hideSelection,\n      highlightedDate: highlightedDate,\n      highlightedRange: highlightedRange,\n      index: index,\n      key: key,\n      selectionType: selectionType,\n      value: value,\n      maxIndex: numberOfCalendars - 1,\n      firstOfMonth: monthDate,\n      onMonthChange: this.changeMonth,\n      onYearChange: this.changeYear,\n      onSelectDate: this.onSelectDate,\n      onHighlightDate: this.onHighlightDate,\n      onUnHighlightDate: this.onUnHighlightDate,\n      dateRangesForDate: this.dateRangesForDate,\n      dateComponent: _CalendarDate2.default,\n      locale: this.props.locale\n    };\n    return _react2.default.createElement(_CalendarMonth2.default, props);\n  },\n  render: function render() {\n    var _props3 = this.props,\n        PaginationArrowComponent = _props3.paginationArrowComponent,\n        className = _props3.className,\n        numberOfCalendars = _props3.numberOfCalendars,\n        stateDefinitions = _props3.stateDefinitions,\n        selectedLabel = _props3.selectedLabel,\n        showLegend = _props3.showLegend,\n        helpMessage = _props3.helpMessage;\n\n    var calendars = _immutable2.default.Range(0, numberOfCalendars).map(this.renderCalendar);\n\n    className = this.cx({\n      element: null\n    }) + ' ' + className;\n    return _react2.default.createElement('div', {\n      className: className.trim()\n    }, _react2.default.createElement(PaginationArrowComponent, {\n      direction: 'previous',\n      onTrigger: this.moveBack,\n      disabled: !this.canMoveBack()\n    }), calendars.toJS(), _react2.default.createElement(PaginationArrowComponent, {\n      direction: 'next',\n      onTrigger: this.moveForward,\n      disabled: !this.canMoveForward()\n    }), helpMessage ? _react2.default.createElement('span', {\n      className: this.cx({\n        element: 'HelpMessage'\n      })\n    }, helpMessage) : null, showLegend ? _react2.default.createElement(_Legend2.default, {\n      stateDefinitions: stateDefinitions,\n      selectedLabel: selectedLabel\n    }) : null);\n  }\n});\nexports.default = DateRangePicker;","map":null,"metadata":{},"sourceType":"script"}